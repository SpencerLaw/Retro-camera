<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>作业消消乐 - 快乐完成作业！</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap" rel="stylesheet">
</head>
<body>

    <!-- 登录/授权界面 -->
    <div id="auth-screen" class="screen active">
        <div class="auth-box">
            <h1>🎒 作业消消乐</h1>
            <p class="subtitle">让每一次作业都变成一次成长！</p>
            <div class="input-group">
                <input type="text" id="license-input" placeholder="请输入老师的魔法授权码" maxlength="19">
                <button id="verify-btn">开启魔法门</button>
            </div>
            <p id="auth-msg"></p>
        </div>
    </div>

    <!-- 主界面 -->
    <div id="app-screen" class="screen hidden">
        <header>
            <div class="header-left">
                <button id="back-btn" class="icon-btn" title="返回首页">🔙</button>
                <div>
                    <h2>🏫 作业消消乐</h2>
                    <div class="date-display">
                        <span id="current-date">加载中...</span>
                        <span id="current-week-day">...</span>
                    </div>
                </div>
            </div>
            <div className="header-right">
                <button id="reset-week-btn" class="secondary-btn">🔄 开始新的一周</button>
                <button id="fullscreen-btn" class="icon-btn" title="全屏显示">📺</button>
                <button id="settings-btn" class="icon-btn" title="设置/学生管理">⚙️</button>
                <button id="logout-btn" class="icon-btn" title="退出">🚪</button>
            </div>
        </header>

        <main>
            <!-- 左侧：消消乐区域 (今日任务) -->
            <section class="game-zone">
                <div class="game-header">
                    <h3 id="daily-task-title">今日任务: 消灭未完成!</h3>
                    <div class="progress-bar">
                        <div id="daily-progress" style="width: 0%"></div>
                    </div>
                </div>
                <div id="student-grid" class="grid-container">
                    <div class="empty-state">
                        点击右上角 ⚙️ 导入学生名单开始游戏！
                    </div>
                </div>
            </section>

            <!-- 中间：奖惩区 (奖励设置) -->
            <section class="rules-zone">
                <div class="rules-panel">
                    <div class="rule-box reward">
                        <label id="reward-label">🏆 全班作业完成奖励:</label>
                        <textarea id="reward-text" placeholder="例如: 全班奖励冰激凌🍦"></textarea>
                    </div>
                    <div class="rule-box punishment">
                        <label id="punishment-label">⚠️ 未完成惩罚:</label>
                        <textarea id="punishment-text" placeholder="例如: 扣除班级积分"></textarea>
                    </div>
                    <button id="save-rules-btn">💾 保存规则</button>
                </div>
            </section>

            <!-- 右侧：大树可视化区 -->
            <section class="visualization-zone">
                <div class="tree-container">
                    <canvas id="tree-canvas"></canvas>
                    <div id="tree-message" class="tree-message"></div>
                </div>
            </section>
        </main>
    </div>

    <!-- 弹窗：导入学生 -->
    <div id="settings-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>📋 管理学生名单</h2>
            
            <div class="tab-container">
                <button class="tab-btn active" data-tab="manual">手动输入</button>
                <button class="tab-btn" data-tab="csv">表格导入</button>
            </div>

            <div id="tab-manual" class="tab-content active">
                <textarea id="student-list-input" placeholder="输入学生姓名，每行一个&#10;张三&#10;李四&#10;王五"></textarea>
            </div>

            <div id="tab-csv" class="tab-content">
                <textarea id="csv-input" placeholder="在此粘贴Excel列或CSV内容..."></textarea>
            </div>

            <div class="modal-actions">
                <button id="import-btn" class="primary-btn">导入并重置游戏</button>
                <button id="clear-data-btn" class="danger-btn">🗑️ 清空所有数据</button>
            </div>
            
            <p class="hint">注意：导入新名单会重置本周进度！</p>
        </div>
    </div>

    <!-- 弹窗：确认完成 -->
    <div id="confirm-modal" class="modal hidden">
        <div class="modal-content confirm-box">
            <h3>✅ 确认完成?</h3>
            <p id="confirm-student-name">学生姓名</p>
            <div class="modal-actions">
                <button id="confirm-yes" class="primary-btn">是，完成了！</button>
                <button id="confirm-no" class="secondary-btn">取消</button>
            </div>
        </div>
    </div>

    <script src="translations.js"></script>
    <script src="script.js"></script>
</body>
</html>
